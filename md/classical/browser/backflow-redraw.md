## 认识回流和重绘

**理解回流reflow**

* 第一次确定节点的大小和位置，称之为布局
* 之后对节点的大小、位置修改重新计算称之为回流

**什么情况下引起回流呢**

* 比如DOM结构发生改变
* 比如改变了布局（修改了width、height、padding、font-size等值）
* 比如窗口resize（修改了窗口的尺寸等）
* 比如调用getComputedStyle方法获取尺寸、位置信息

**理解重绘repaint**

* 第一次渲染内容称之为绘制（paint）
* 之后重新渲染称之为重绘

**什么情况下会引起重绘呢**

* 修改背景色、文字颜色、边框颜色、样式

## **重绘和回流的性能优化**

**回流一定会引起重绘，所以回流是一件很消耗性能的事情。**

**所以在开发中要尽量避免发生回流**

1. 修改样式的时候尽量一次修改
   1. 比如通过cssText修改，比如通过添加class修改
2. 尽量避免频繁操作dom
   1. 我们可以在一个DocumentFragment或者父元素中将要操作的DOM操作完成，再以一次性的操作
3. 尽量避免通过getComputedStyle获取尺寸、位置信息
   1. 频繁调用getComputedStyle可以导致回流，因为浏览器需要提供准确的计算值
4. 对某些元素使用position的absolute或者fixed
   1. 并不是不会引起回流，而是开销相对较小，不会对其他元素造成影响

**额外的方法**

* 新的合成层：在特定情况下，可以创建新的合成层，并且新的图层可以利用GPU来加速绘制也可以提供性能

## 特殊解析-composite合成

**绘制的过程，可以将布局后的元素绘制到多个合成图层中**

* 这是浏览器的一种优化手段

**默认情况下，标准流中的内容都是被绘制在同一个图层（Layer）中的**

**而一些特殊的属性，会创建一个新的合成层（ CompositingLayer ），并且新的图层可以利用GPU来加速绘制**

* 因为每个合成层都是单独渲染的

**那么哪些属性可以形成新的合成层呢？常见的一些属性**

* 3D transform
* video canvas iframe
* opacity 动画转化时
* position: fixed
* will-change: 一个实验性的属性 提前告诉浏览器元素可能发生那些变化
* animation 或 transition 设置了 opacity、transform

**分层确实可以提高性能，但是他以内存管理为代价，因此不应作为性能优化策略的一部分过渡使用**